name: Ransomware or Malware Process Detected (Generic 2)
id: 8e7d9c2a-5f1b-4c3d-b8e1-6a8f37d49b5c
version: 1.0.2
description: |
  Ransomware or Malware process detected:
  
  Detects Vipasana ransomware's unique initialization sequence combining memory allocation 
  with rapid directory discovery. Vipasana maps PAGEFILE sections, verifies Windows system 
  directories, loads WOW64 compatibility layers, then immediately targets user Desktop folders 
  for encryption. This 45ms pattern provides early detection before file damage occurs.
  
  Normal: Gradual directory access, system maintenance tools, operations >50ms apart
  Likely malicious: PAGEFILE(16384)→Windows→wow64*.dll→Desktop folder→SysWOW64 DLL <45ms
enabled: true

labels:
  tactic.id: TA0040
  tactic.name: Impact
  tactic.ref: https://attack.mitre.org/tactics/TA0040/
  technique.id: T1486
  technique.name: Data Encrypted for Impact 
  technique.ref: https://attack.mitre.org/techniques/T1486/

tags:
  - ransomware
  - vipasana
  - early-detection 
  - file-io-sequence

references:
  - https://attack.mitre.org/techniques/T1486/

condition: >
  sequence
    maxspan 45ms
    by ps.uuid
    |(
      kevt.name = 'MapViewFile'  
      and file.view.type = 'PAGEFILE'
      and file.view.size = 16384
    )|
    |(
      kevt.name = 'CreateFile'
      and file.path imatches 'C:\\Windows' 
      and kevt.arg[type] = 'Directory'
    )|  
    |(
      kevt.name = 'MapViewFile'
      and file.view.type = 'IMAGE' 
      and file.path imatches 'C:\\Windows\\System32\\wow64*.dll'
    )|
    |(  
      kevt.name = 'CreateFile'
      and file.path imatches 'C:\\Users\\*\\Desktop\\' 
      and kevt.arg[type] = 'Directory'
    )|
    |(
      kevt.name = 'MapViewFile'  
      and file.view.type = 'IMAGE'
      and file.path imatches 'C:\\Windows\\SysWOW64\\*.dll'  
    )|

output: |
  Ransomware or Malware process detected:
  Image Path: %ps.exe
  Suspect File I/O: %kevt.name on %file.name

  Process Information:

  - Process Name: %ps.name 
  - Command Line: %ps.cmdline
  - Parent Process: %ps.parent.name (PPID: %ps.ppid)

  - Signature Status: %pe.is_signed
  - Cert Subject: %pe.cert.subject
  - Cert Issuer: %pe.cert.issuer
  - Process is Modified?: %pe.is_modified

severity: critical  

min-engine-version: 2.0.0
