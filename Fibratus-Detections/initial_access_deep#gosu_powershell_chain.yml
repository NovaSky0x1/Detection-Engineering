name: Kimsuky DEEP#GOSU multi-stage VBScript to PowerShell execution
id: c8f1a5d4-6b9e-2d8c-4f0a-9e7b3c5d6789
version: 1.0.0
description: |
  Kimsuky DEEP#GOSU Chain Detected:
  
  Detects the Kimsuky APT group's DEEP#GOSU malware execution chain, which employs a 
  multi-stage evasion technique starting with VBScript/Windows Script Host execution 
  that spawns encoded PowerShell commands. This North Korean threat actor commonly uses 
  this pattern to deploy backdoors and information stealers while evading detection 
  through heavy obfuscation and Base64 encoding. The malware typically arrives via 
  spear-phishing emails targeting South Korean entities and uses living-off-the-land 
  binaries to maintain stealth.
  
  Normal: wscriptâ†’powershell with clear text commands, from %ProgramFiles%, signed scripts
  Likely malicious: Base64 >100 chars, -enc/-e flags, from %TEMP%/%Downloads%, recent file creation
labels:
  tactic.id: TA0005
  tactic.name: Defense Evasion
  tactic.ref: https://attack.mitre.org/tactics/TA0005/

condition: >
  spawn_process 
    and
  ps.parent.name iin ('wscript.exe', 'cscript.exe')
    and
  ps.name iin ('powershell.exe', 'pwsh.exe')
    and
  (ps.cmdline imatches ('*-enc*', '*-encodedcommand*', '*-e *') or regex(ps.cmdline, '[A-Za-z0-9+/]{40,}={0,2}'))

output: |
  Kimsuky DEEP#GOSU Chain Detected
  
  Script Host Parent: %ps.parent.name
  PowerShell Process: %ps.name  
  Encoded Command: %ps.cmdline

severity: critical

min-engine-version: 2.4.0