name: Windows Defender Disabling Attempt
id: 8c2f5b7a-d93e-47f5-9b1a-3f6e8e2c91fc
version: 1.3.0
description: >
  Windows Defender Tampering Detected:
  
  Detects direct registry modifications to disable Windows Defender real-time protection. 
  Setting DisableRealtimeMonitoring to 1 immediately disables antivirus scanning, a common 
  technique used by ransomware and infostealers before payload execution. This is a critical 
  security event requiring immediate response as it removes primary endpoint protection.
  
  Normal: Group Policy updates (svchost.exe), MDM tools
  Likely malicious: Direct registry edits setting value=1, PowerShell Set-MpPreference, non-system processes
enabled: true
labels:
  tactic.id: TA0005
  tactic.name: Defense Evasion
  tactic.ref: "https://attack.mitre.org/tactics/TA0005/"
  technique.id: T1562.001
  technique.name: Impair Defenses - Disable or Modify Tools
  technique.ref: "https://attack.mitre.org/techniques/T1562/001/"
tags:
  - windows defender
  - defense evasion
  - registry modification
  - tampering
references:
  - "https://attack.mitre.org/techniques/T1562/001/"

condition: >
  kevt.name = 'RegSetValue'
  and ps.name = 'MsMpEng.exe'
  and (
    registry.path = 'HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows Defender\\Real-Time Protection\\DisableRealtimeMonitoring'
    )
  and (
    registry.value = 1
    )

output: >
  Windows Defender Tampering Detected! : If value = 1 then Defender is Disabled.
  - Registry Key Modified: %registry.key.name

  Process Information:

  - Process Name: %ps.name 
  - Command Line: %ps.cmdline
  - Parent Process: %ps.parent.name (PPID: %ps.ppid)

  - Signature Status: %pe.is_signed
  - Cert Subject: %pe.cert.subject
  - Cert Issuer: %pe.cert.issuer
  - Process is Modified?: %pe.is_modified

severity: critical

min-engine-version: 2.0.0
