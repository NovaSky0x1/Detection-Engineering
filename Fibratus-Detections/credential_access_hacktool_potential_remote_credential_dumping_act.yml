name: Remote Credential Dumping via CrackMapExec/Impacket
id: 0c0bf53b-9875-48ce-a389-0d309f51fdcf
version: 1.0.0
description: |
  Remote Credential Dumping Activity Detected:

  Detects temporary file patterns created by CrackMapExec and Impacket-secretsdump during 
  remote credential harvesting. These tools dump SAM/SECURITY/SYSTEM registry hives to 
  8-character random .tmp files in System32. The files are created by svchost.exe during 
  remote registry operations initiated by the attacking tools.

  Normal: Never - legitimate Windows operations don't create random 8-char .tmp files
  Likely malicious: svchost.exe creating [8chars].tmp in System32

enabled: true
labels:
  tactic.id: TA0006
  tactic.name: Credential Access
  tactic.ref: https://attack.mitre.org/tactics/TA0006/
  technique.id: T1003
  technique.name: OS Credential Dumping
  technique.ref: https://attack.mitre.org/techniques/T1003/

tags:
- crackmapexec
- impacket
- secretsdump

references:
- https://github.com/Porchetta-Industries/CrackMapExec
- https://github.com/fortra/impacket/blob/master/examples/secretsdump.py

condition: >
  create_file
    and
  ps.exe iendswith '\\svchost.exe'
    and
  file.path matches '?:\\Windows\\System32\\????????.tmp'

output: |-
  Remote Credential Dumping Activity

  Suspicious Temp File: %file.path
  Created By: %ps.name

  Process Information:

  - Process Name: %ps.name 
  - Command Line: %ps.cmdline
  - Parent Process: %ps.parent.name (PPID: %ps.ppid)

  - Signature Status: %pe.is_signed
  - Cert Subject: %pe.cert.subject
  - Cert Issuer: %pe.cert.issuer
  - Process is Modified?: %pe.is_modified

severity: high

min-engine-version: 2.0.0
