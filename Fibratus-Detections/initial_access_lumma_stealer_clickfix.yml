name: Lumma Stealer ClickFix clipboard-based code execution
id: e7b3c6d5-8f1a-9c2e-3d6f-0a4b5e7c8901
version: 1.0.0
description: |
  Lumma Stealer ClickFix Detected:
  
  Detects Lumma Stealer's ClickFix social engineering technique that tricks users into 
  executing malicious code via fake error messages or browser notifications. Victims 
  are instructed to copy malicious JavaScript/VBScript commands to their clipboard and 
  paste them into the Run dialog, which executes mshta.exe with inline scripts. This 
  method bypasses traditional download-based detection and leverages user interaction 
  to initiate the infection chain, ultimately deploying the Lumma information stealer 
  to harvest credentials, cryptocurrency wallets, and browser data.
  
  Normal: mshta.exe with .hta file paths, launched by installers, no inline code
  Likely malicious: javascript:/vbscript:/about: protocols, inline code execution, explorer.exe parent
labels:
  tactic.id: TA0005
  tactic.name: Defense Evasion
  tactic.ref: https://attack.mitre.org/tactics/TA0005/

condition: >
  spawn_process 
    and
  ps.child.name ~= 'mshta.exe'
    and
  ps.child.cmdline imatches ('*javascript:*', '*vbscript:*', '*about:*')

output: |
  Lumma Stealer ClickFix Detected
  
  MSHTA Execution:
  - Process: %ps.child.name
  - Command: %ps.child.cmdline
  - Parent: %ps.name
  - Process Path: %ps.child.exe

severity: high

min-engine-version: 2.4.0